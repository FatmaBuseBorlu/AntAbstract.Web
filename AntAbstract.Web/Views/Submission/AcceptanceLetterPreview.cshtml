@using AntAbstract.Application.DTOs.Submission
@using System.Linq
@using Microsoft.AspNetCore.Hosting
@inject IWebHostEnvironment WebHostEnvironment
@model SubmissionDto

@{
    Layout = null;

    var firstAuthor = Model.Authors?.OrderBy(a => a.Order).FirstOrDefault();
    var authorFullName = firstAuthor != null ? $"{firstAuthor.FirstName} {firstAuthor.LastName}" : Model.CorrespondingAuthorName;

    var documentNumber = Model.Id.ToString().Substring(0, 8).ToUpper();

    var acceptanceDate = Model.DecisionDate ?? DateTime.Now;
}

@functions {
    public string GetImage(string imageName)
    {
        if (string.IsNullOrEmpty(imageName)) return "";
        string webRoot = WebHostEnvironment.WebRootPath;
        string path = System.IO.Path.Combine(webRoot, "images", imageName);
        if (System.IO.File.Exists(path))
        {
            byte[] imageArray = System.IO.File.ReadAllBytes(path);
            string base64 = Convert.ToBase64String(imageArray);
            var extension = System.IO.Path.GetExtension(path).Replace(".", "").ToLower();
            return $"data:image/{extension};base64,{base64}";
        }
        return "";
    }
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Certificate of Participation</title>
    <style>
        body {
            font-family: 'Times New Roman', Times, serif;
            margin: 0;
            padding: 0;
            background-color: #fff;
            color: #000;
            overflow: hidden;
        }

        .page-container {
            width: 100%;
            padding: 40px 60px;
            box-sizing: border-box;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            border: none;
        }

        td {
            vertical-align: top;
            border: none;
        }

        .header-row {
            margin-bottom: 30px;
        }

        .journal-title {
            font-family: 'Arial', sans-serif;
            font-size: 22px;
            font-weight: bold;
            font-style: italic;
            color: #6a1b43;
            line-height: 1;
        }

        .journal-subtitle {
            font-family: 'Arial', sans-serif;
            font-size: 22px;
            font-weight: normal;
            color: #6a1b43;
        }

        .open-access {
            font-family: 'Arial', sans-serif;
            font-size: 9px;
            color: #333;
            margin-top: 5px;
        }

        .badge-container {
            text-align: right;
        }

        .badge-table {
            width: auto;
            margin-left: auto;
        }

        .badge {
            display: inline-block;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            text-align: center;
            color: #fff;
            font-family: Arial, sans-serif;
            font-size: 7px;
            font-weight: bold;
            padding-top: 14px;
            box-sizing: border-box;
            margin-left: 5px;
            line-height: 1.1;
        }

        .bg-yellow {
            background-color: #ffcc00 !important;
            color: #000 !important;
            -webkit-print-color-adjust: exact;
        }

        .bg-blue {
            background-color: #0055a5 !important;
            -webkit-print-color-adjust: exact;
        }

        .bg-dark {
            background-color: #002c5f !important;
            -webkit-print-color-adjust: exact;
        }

        .badge span {
            font-size: 11px;
            display: block;
            margin-top: 1px;
        }

        .content-wrapper {
            text-align: center;
            margin-top: 10px;
            padding: 0 20px;
        }

        .wreath {
            width: 110px;
            display: block;
            margin: 0 auto 15px auto;
        }

        h1 {
            font-size: 32px;
            text-transform: uppercase;
            margin: 5px 0 30px 0;
            letter-spacing: 2px;
            color: #000;
        }

        .text-intro {
            font-size: 16px;
            margin-bottom: 15px;
        }

        .paper-title {
            font-size: 20px;
            font-weight: bold;
            margin: 20px auto;
            padding: 10px 0;
            display: block;
            max-width: 100%;
            border: none;
        }

        .date-info {
            font-size: 16px;
            margin-top: 10px;
        }

        .footer-row {
            margin-top: 60px;
            border: none;
            padding-top: 20px;
        }

        .mdpi-box {
            border: 2px solid #000;
            padding: 5px 12px;
            display: inline-block;
            font-family: Arial, sans-serif;
            font-weight: bold;
            font-size: 18px;
            letter-spacing: 2px;
        }

        .city-date {
            font-family: Arial, sans-serif;
            font-size: 9px;
            margin-top: 5px;
        }

        .signature-img {
            height: 45px;
            display: block;
            margin-left: auto;
            margin-bottom: 5px;
        }

        .signature-line {
            border-top: 1px solid #000;
            width: 220px;
            float: right;
            text-align: left;
            padding-top: 5px;
            font-family: Arial, sans-serif;
            font-size: 11px;
        }

        * {
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
    </style>
</head>
<body>

    <div class="page-container">

        <table class="header-row">
            <tr>
                <td style="width: 60%;">
                    <div style="display:flex; align-items:center;">
                        <img src="@GetImage("dna.png")" width="40" style="margin-right: 10px;" />
                        <div>
                            <div class="journal-title">International Journal of</div>
                            <div class="journal-subtitle">Molecular Sciences</div>
                        </div>
                    </div>
                    <div class="open-access">an Open Access Journal by ANT ABSTRACT</div>
                </td>
                <td class="badge-container">
                    <table class="badge-table">
                        <tr>
                            <td style="padding-left: 5px;"><div class="badge bg-yellow">IMPACT<br>FACTOR<span>4.9</span></div></td>
                            <td style="padding-left: 5px;"><div class="badge bg-blue">Indexed in:<br><strong>PubMed</strong></div></td>
                            <td style="padding-left: 5px;"><div class="badge bg-dark">CITESCORE<span>9.0</span></div></td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>

        <div class="content-wrapper">
            <img src="@GetImage("wreath.png")" class="wreath" />

            <h1>Certificate of Participation</h1>

            <div class="text-intro">
                This is to certify that <strong>@authorFullName</strong> has successfully participated and presented the manuscript:
            </div>

            <div class="paper-title">
                "@Model.Title"
            </div>

            <div class="text-intro">
                (ID: <strong>@documentNumber</strong>)
            </div>

            <div class="date-info">
                at <strong>@(Model.ConferenceTitle ?? "AntAbstract Conference")</strong> <br>
                held on <strong>@acceptanceDate.ToString("dd MMMM yyyy")</strong>.
            </div>
        </div>

        <table class="footer-row">
            <tr>
                <td style="vertical-align: bottom; width: 30%;">
                    <div class="mdpi-box">ANT</div>
                    <div class="city-date">Antalya, @DateTime.Now.ToString("MMMM yyyy")</div>
                </td>
                <td style="text-align: right; vertical-align: bottom;">
                    <img src="@GetImage("signature.png")" class="signature-img">
                    <div class="signature-line">
                        <strong>Prof. Dr. Kongre Başkanı</strong><br>
                        Scientific Committee Chair
                    </div>
                </td>
            </tr>
        </table>

    </div>
</body>
</html>